# 锁屏程序

这是一个基于Python的锁屏程序，用于图书馆电脑需要临时限制屏幕使用，防止未授权访问。适用于不能锁屏又需要保护隐私的场景。

## 主要功能

- **完全锁定**：全屏界面阻止用户访问系统
- **密码保护**：通过密码验证确保只有授权用户能解锁系统
- **虚拟键盘**：支持鼠标输入密码，防止键盘记录器
- **系统热键拦截**：阻止所有Windows系统热键（如Alt+Tab, Ctrl+Alt+Del等）
- **系统工具阻止**：禁用任务管理器和其他可能绕过锁屏的系统工具
- **进程监控**：自动终止可能威胁锁屏安全的危险进程
- **窗口监视**：自动检测并恢复最小化或隐藏的锁屏窗口
- **修改密码**：提供安全的密码修改界面
- **自定义界面**：可通过配置文件自定义界面颜色和外观

## 日志记录功能

程序包含详细的日志记录系统，便于排查问题和分析使用情况：

- **自动日志文件**：按日期自动创建日志文件，格式为 `logs/lockscreen_YYYYMMDD.log`
- **多级别日志**：记录不同级别的日志（DEBUG, INFO, WARNING, ERROR, CRITICAL）
- **详细记录**：包括所有关键操作、错误信息及完整异常堆栈
- **可配置**：可通过配置文件开启或关闭日志记录功能

日志内容包括：
- 程序启动和关闭事件
- 快捷键拦截信息
- 用户解锁尝试（成功/失败）
- 系统进程监控结果
- 各种异常和错误情况

## 环境要求

- **操作系统**：Windows系统（最佳支持）
- **Python**：Python 3.6+
- **必需库**：
  - tkinter (GUI界面)
  - keyboard (键盘钩子和拦截)
  - pywin32 (Windows API交互)
  - pynput (输入监控)
  - psutil (进程管理)

## 安装

1. 克隆或下载本项目代码
2. 使用安装向导创建虚拟环境并安装依赖：
   ```
   setup.bat
   ```
   或手动安装依赖：
   ```
   pip install -r requirements.txt
   ```

## 使用方法

使用批处理文件启动程序：
```
run_lockscreen.bat
```

或直接运行Python脚本：
```
python lock_screen.py
```

**注意：** 强烈建议以管理员权限运行，以确保所有安全功能正常工作。

## 配置

程序使用 `lockscreen_config.ini` 进行配置，包括：

- **安全设置**:
  - `password` - 解锁密码
  - `allowvirtualkeyboard` - 启用/禁用虚拟键盘 (yes/no)
  - `killdangerousprocesses` - 是否终止危险进程 (yes/no) 
  - `enablelogging` - 启用/禁用日志记录 (yes/no)

- **界面设置**:
  - `backgroundcolor` - 背景颜色
  - `textcolor` - 文本颜色
  - `buttoncolor` - 按钮颜色

首次运行时会自动创建默认配置文件。

### 配置示例:

```ini
[Security]
password = 123456
allowvirtualkeyboard = yes
killdangerousprocesses = yes
enablelogging = yes

[UI]
backgroundcolor = #2c3e50
textcolor = white
buttoncolor = #3498db
```

## 安全提示

- **默认密码**：程序默认密码为 `123456`，建议首次使用后立即修改
- **密码保存**：出于安全考虑，程序将密码保存在配置文件中，请确保配置文件的安全
- **测试**：在重要场合使用前，建议先在个人环境中测试程序功能
- **管理员权限**：完整的系统保护功能需要管理员权限才能正常工作

## 工作原理

锁屏程序使用多种技术确保安全：

1. **全局钩子**：使用keyboard库拦截所有键盘输入和系统热键
2. **Windows API**：调用Win32 API维持窗口焦点和置顶状态
3. **进程监控**：使用psutil监控和终止危险进程
4. **注册表操作**：临时禁用任务管理器等系统工具
5. **多线程监控**：使用线程持续监视窗口状态、键盘状态和系统组合键

## 问题排查

如遇问题，请：

1. **检查日志**：查看`logs`目录中的日志文件获取详细错误信息
2. **启用日志**：如果日志被禁用，请在配置文件中设置`enablelogging = yes`
3. **管理员权限**：确认是否以管理员权限运行程序
4. **依赖检查**：确保已安装所有必需的Python库

常见问题包括：

1. **权限问题**：某些功能（如禁用任务管理器）需要管理员权限
2. **依赖项缺失**：确保已安装所有需要的Python库
3. **窗口焦点问题**：部分强制应用可能会争抢窗口焦点
4. **配置文件编码**：如果包含中文注释，确保以UTF-8编码保存配置文件
